/*
 * File: xbmview.c
 * Date: 2019-11-17
 *
 * Displays a X BitMap (XBM) image on the screen.
 *
 * This example shows
 * - Reading XBM bitmap from file
 * - Using the ncurses pad structure
 * - Scrolling the bitmap when it does not fit in the display area
 *
 * Compile and run on Linux:
 * > gcc -Wall -Wextra -std=c99 -pedantic -o xbmview xbmview.c -lncurses
 * > ./xbmview [file.xbm]
 *
 * If no filename is passed the program shows a test bitmap.
 */
#define _GNU_SOURCE
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <strings.h>
#include <sys/stat.h>
#include <ncurses.h>

#define MIN_WIDTH    1
#define MIN_HEIGHT   1
#define MAX_WIDTH    512
#define MAX_HEIGHT   512
#define MAX_FSIZE    (1*1024*1024)

/* Representation of XBM file in memory. */
struct xbm_dat
{
	int width;
	int height;
	unsigned char *data;
	int len;
};

static bool init_ui();
static void deinit_ui();
static struct xbm_dat *load_xbm_file(const char *);
static struct xbm_dat *load_test_bitmap(struct xbm_dat *);
static void unload_xbm_file(struct xbm_dat **);
static bool render_xbm_file(const struct xbm_dat *);
static void set_pad_data(WINDOW *, const unsigned char *, int , int );
static void free_mem(char **, size_t);

/* Program to load and display a XBM bitmap file. */
int main(int argc, char **argv)
{
	struct xbm_dat xbm_test;
	struct xbm_dat *xbm_user = NULL;
	struct xbm_dat *xbm_ptr = NULL;

	if (argc == 1)
	{
		xbm_ptr = load_test_bitmap(&xbm_test);
	}
	else if (argc == 2)
	{
		if ((xbm_ptr = xbm_user = load_xbm_file(argv[1])) == NULL)
			exit(EXIT_FAILURE);
	}
	else
	{
		fprintf(stderr,
		"Yet another X BitMap (XBM) viewer.\n"
		"Usage: %s [file.xbm]\n", argv[0]);
		exit(EXIT_FAILURE);
	}

	if (init_ui() == true)
	{
		mvaddstr(0, 0, "For large bitmaps, use the arrow keys to scroll in the direction you wish.\nPress 'q' to quit.");
		refresh();
		render_xbm_file(xbm_ptr);
	}

	deinit_ui();
	if (xbm_user != NULL)
		unload_xbm_file(&xbm_user);
	exit(EXIT_SUCCESS);
}

/* Draws the XBM bitmap on the screen. The display area could be smaller than
   the XBM bitmap. The user can move over the bitmap using the arrow keys. */
static bool render_xbm_file(const struct xbm_dat *xbm)
{
	const int x0 = COLS / 2 - COLS / 4;
	const int y0 = LINES / 2 - LINES / 4;
	const int x1   = x0 + COLS / 2;
	const int y1   = y0 + LINES / 2;
	const int width = x1 - x0 + 1;
	const int height = y1 - y0 + 1;
	const int step = 5;
	int x = 0;
	int y = 0;
	int key = 0;
	WINDOW *pad = NULL;
	bool ret = true;
	
	/* Create a ncurses pad window. This allows to display a specified section of the bitmap. */
	if ((pad = newpad(xbm->height, xbm->width)) == NULL)
		return false;

	/* Set the pad display data to the bitmap data. */
	set_pad_data(pad, xbm->data, xbm->width, xbm->height);

	/* Drawing loop */
	while (true)
	{
		/* Update the pad data on the screen and wait for user input. */
		if (prefresh(pad, y, x, y0, x0, y1, x1) == ERR || (key = getch()) == ERR)
		{
			ret = false;
			break;
		}

		/* Specifying the bitmap section that should be displayed in the pad window by
		   calculating the start offsets. */
		if (key == 'Q' || key == 'q')
		{
			break;
		}
		else if (key == KEY_RIGHT)
		{
			if (xbm->width > width && x < xbm->width - width)
				x = x + step < xbm->width - width ? x + step : x + 1;
		}
		else if (key == KEY_LEFT)
		{
			if (x > 0)
				x = x >= step ? x - step : x - 1;
		}
		else if (key == KEY_DOWN)
		{
			if (xbm->height > height && y < xbm->height - height)
				y = y + step < xbm->height - height ? y + step : y + 1;
		}
		else if (key == KEY_UP)
		{
			if (y > 0)
				y = y >= step ? y - step : y - 1;
		}
	}
	
	if (pad != NULL)
	{
		delwin(pad);
		pad = NULL;
	}

	return ret;
}

/* Fill the padding window with the XBM object data. */
static void set_pad_data(WINDOW *pad, const unsigned char *bits, int width, int height)
{
	int y = 0;
	for ( ; y < height; y++)
	{
		int x = 0;
		do
		{
			int i = 0;
			for ( ; i < 8 && x < width; i++, x++)
				mvwaddch(pad, y, x, (*bits & (1 << i)) ? ACS_CKBOARD : 0x20);
			bits++;
		} while (x < width);
	}
}

/* Reads a XBM bitmap file and returns an object containing it's data and attributes. */
static struct xbm_dat* load_xbm_file(const char *filename)
{
	FILE *fp = NULL;
	char *fbuf = NULL;
	struct xbm_dat *xbm = NULL;
	struct stat sb;
	int countbytes = 0;
	long fsize = 0;
	int i = 0;
	int n = 0;

	/* Read the complete XBM bitmap file into memory. */
	if (   filename == NULL
	    || strlen(filename) <= 4
		|| strcasecmp(filename + strlen(filename) - 4, ".xbm")
		|| stat(filename, &sb) == -1
		|| S_ISREG(sb.st_mode) == 0
		|| (fp = fopen(filename, "rb")) == NULL
	    || fseek(fp, 0L, SEEK_END) == -1
		|| (fsize = ftell(fp)) <= 0
		|| fseek(fp, 0L, SEEK_SET) == -1
		|| fsize > MAX_FSIZE
		|| (fbuf = calloc((size_t) fsize + 1, 1)) == NULL
	    || fread(fbuf, 1, (size_t) fsize, fp) != (size_t) fsize
		|| (xbm = calloc(sizeof(struct xbm_dat), 1)) == NULL)
	{
		goto out_err;
	}

	/* Search the width and height attributes of the bitmap. */
	for (i = 0, n = (int) fsize; i < n; i++)
	{
		if ((   fbuf[i] == 'w' && i + 5 < n && !strncmp(&fbuf[i], "width", 5)
		     && sscanf(&fbuf[i + 5], "%d", &xbm->width) != 1) ||
			(   fbuf[i] == 'h' && i + 6 < n && !strncmp(&fbuf[i], "height", 6)
			 && sscanf(&fbuf[i + 6], "%d", &xbm->height) != 1))
		{
			goto out_err;
		}
		else if (fbuf[i] == 'b' && i + 4 < n && !strncmp(&fbuf[i], "bits", 4))
			break;
	}

	if (i == n || xbm->width < MIN_WIDTH || xbm->width > MAX_WIDTH || xbm->height < MIN_HEIGHT || xbm->height > MAX_HEIGHT)
		goto out_err;

	/* Calculate the number of bytes that are necessary to store this XBM data. */
	xbm->len = xbm->height * ((xbm->width + 7) / 8);

	if ((xbm->data = malloc(xbm->len)) == NULL)
		goto out_err;

	/* Convert the C array holding the bitmap data to raw byte values. */
	for ( ; i < n && fbuf[i] != '}'; i++)
	{
		if (fbuf[i] == '0' && i + 1 < n && (fbuf[i + 1] == 'x' || fbuf[i + 1] == 'X'))
		{
			unsigned int val;
			if (countbytes == xbm->len || sscanf(&fbuf[i], "%x", &val) != 1 || val > 0xff)
				goto out_err;
			xbm->data[countbytes++] = (unsigned char) val;
		}
	}
	
	if (i == n || countbytes != xbm->len)
		goto out_err;
	
	/* Success. Return XBM object. */
	free_mem(&fbuf, (size_t) fsize + 1);
	fclose(fp);
	fp = NULL;
	return xbm;

out_err:
	/* Error handling. */
	if (xbm)
	{
		if (xbm->data)
			free_mem((char **) &xbm->data, xbm->len);
		free_mem((char **) &xbm, sizeof(*xbm));
	}
	if (fbuf)
		free_mem(&fbuf, (size_t) fsize + 1);
	if (fp)
	{
		fclose(fp);
		fp = NULL;
	}
	return NULL;
}

/* Free memory uses by the XBM object. */
static void unload_xbm_file(struct xbm_dat **xbm)
{
	if (xbm)
	{
		free_mem((char **) &(*xbm)->data, (*xbm)->len);
		free_mem((char **) xbm, sizeof(**xbm));
	}
}

/* Initializes the ncurses mode. */
static bool init_ui()
{
	return !(initscr()                 == NULL    /* init curses */
	    || cbreak()                    == ERR     /* disable line buffering */
	    || noecho()                    == ERR     /* do our own echoing */
	    || nonl()                      == ERR     /* don't translate return key into newline */
	    || intrflush(stdscr, FALSE)    == ERR     /* prevent flush when interrupt key is pressed */
	    || keypad(stdscr, TRUE)        == ERR     /* return single value for function keys */
	);
}

/* Deinitialize ncurses mode. */ 
static void deinit_ui()
{
	endwin();
}

/* Helper function that sanitizes and frees memory of the block
   pointed to by ptr. Not really necessary but careful clean-up
   avoids artifacts in memory and increases security. */
static void free_mem(char **ptr, size_t size)
{
	if (ptr != NULL && size > 0)
	{
		memset(*ptr, 0, size);
		free(*ptr);
		*ptr = NULL;
	}
}

/* If no xbm-file is specified show this test bitmap. */
static struct xbm_dat *load_test_bitmap(struct xbm_dat *test)
{
	static unsigned char bits[] = {
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x47, 0xC7, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x61, 0xE1, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x0F, 0xFF, 0x7F, 0xFF,
		0x7C, 0x3C, 0x7F, 0xCF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0x38, 0x7E, 0xFF, 0x7F, 0x7E, 0x3E, 0x9F, 0x4F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x7C, 0x7E, 0xFF, 0x7F,
		0x7E, 0x7E, 0xCF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0x7E, 0x5F, 0x1C, 0x3C, 0x3E, 0x3E, 0xCF, 0x6F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x3F, 0x7F, 0x03, 0x66, 0x06,
		0x00, 0x84, 0x01, 0xE1, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0x1F, 0x07, 0xCE, 0x73, 0x3E, 0x3F, 0x9F, 0x67, 0xE7,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x1F,
		0x03, 0xCF, 0x33, 0x1E, 0x1F, 0x8F, 0x67, 0xE3, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x1F, 0x9F, 0x67, 0x11, 0x18, 0x9F, 0x4F, 0x62, 0x33,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x1F,
		0x8F, 0x67, 0x01, 0x1C, 0x9F, 0x0F, 0x02, 0x03, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x3F, 0x80, 0x67, 0x01, 0x0E,
		0x8F, 0x0F, 0xC3, 0x63, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x4F, 0xFF, 0x7F, 0xCF, 0x4F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x67, 0xFF, 0x7F, 0xE7,
		0x67, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x63, 0xFF, 0x7F, 0xE7, 0x67, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x3F, 0xFC, 0x7F, 0x7F, 0x78,
		0xF8, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F,
		0xFF, 0x7F, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF, 0x7F, 0xFF,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	};

	test->width = 256;
	test->height = 64;
	test->len = 2048;
	test->data = bits;

	return test;
}

/* xbmview.c EOF */
